_7ba‍.x([["verificoPlacaEnCache",()=>verificoPlacaEnCache]]);const redis = require('redis')
const redisClient = redis.createClient()

const chave = () => {
    return {
        placa: "ABC",
        renavam: 123
}
}

const car = () =>{
    return [{
        
        placa:'ABC',
        renavam: 123,
        debitos:[
            { 
              valor:200,
              descricao: "Multa A"

            },
            {
                valor:500,
                descricao: "Multa B"
            }
            
        ]
    },
    {
        placa: 'ABC',
        renavam: 456,
        debitos: [
            {
               valor: 300,
               descricao:"Multa A"
            },
            {
                valor: 356,
                descricao:"Multa B"
            }
            
        ]
    },
    {
      placa: 'CDE',
      renavam: 123,
      debitos: [
        {
           valor: 500,
           descricao:"Multa C"
        },
        {
            valor: 800,
            descricao:"Multa D"
        }
        
     ]
    },
    {
        placa: 'CDE',
        renavam: 456,
        debitos: [
            {
               valor: 100,
               descricao:"Multa A"
            },
            {
                valor: 400,
                descricao:"Multa D"
            }
            
        ]
    },{
        placa: 'FGH',
        renavam: 456,
        debitos: [
            {
               valor: 100,
               descricao:"Multa A"
            },
            {
                valor: 400,
                descricao:"Multa D"
            }
            
        ]
    }
]
 
}

const verificoPlacaEnCache = (car) => {
     
     return  redisClient.get(`${car.placa}`, (err,obj) => {
        if (obj) {
            console.log('Encontrado en la cache')
            return obj
        }

         console.log('Buscando información fuera de la cache')
         redisClient.setex(`${car.placa}`, 10, JSON.stringify(car()))
         return car()
         
         
        
    }
     
    )
    
     
     
     
}

const verificoRenavamEnCache = (car) => {

     return redisClient.get(`${car.renavam}`, (err, obj) => {
        if (obj) {
            console.log('Encontrado en la cache')
            return obj
        }

        console.log('Buscando información fuera de la cache')
        redisClient.setex(`${car.renavam}`, 3600, JSON.stringify (car))
        return Find(car.renavam)
        
    })  
}

 const Find = (car) => {
     const carr = req.body
     return redisClient.get(`${carr.placa},${carr.renavam}`, (err,obj)=> {
     if(carr.placa ==='ABC' && carr.renavam === 123){
         return{
             placa: 'ABC',
             renavam: 123,
             debitos: [
                 {
                    valor: 200,
                    descricao:"Multa A"
                 },
                 {
                     valor: 300,
                     descricao:"MUlta B"
                 }
                 
             ]
         }
         
     }
     if(carr.placa === 'ABC' && carr.renavam === 456){
        return{
            placa: 'ABC',
            renavam: 456,
            debitos: [
                {
                   valor: 300,
                   descricao:"Multa A"
                },
                {
                    valor: 356,
                    descricao:"Multa B"
                }
                
            ]
        }
     }
     if(carr.placa === 'CDE' && carr.renavam === 123){
        return{
            placa: 'CDE',
            renavam: 123,
            debitos: [
                {
                   valor: 500,
                   descricao:"Multa C"
                },
                {
                    valor: 800,
                    descricao:"Multa D"
                }
                
            ]
        }
     }
     if(carr.placa === 'CDE' && carr.renavam === 456){
        return{
            placa: 'CDE',
            renavam: 456,
            debitos: [
                {
                   valor: 100,
                   descricao:"Multa A"
                },
                {
                    valor: 400,
                    descricao:"Multa D"
                }
                
            ]
        }
     }
     else{
        console.log('No se encontro esa informacion en el servidor')
   }
 }
)}


 


